<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>untitled</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<style>
		body {
			margin:0px;
			padding:0px;
			background-color:steelblue;
			background:url("/images/cloud.jpg");
		}


		#header {
			height:60px;
			width:100%;
			top:0px;
			position:fixed;
			background-color:rgba(221,221,221,0.6);
			box-shadow: 0 0 15px 1px black;
			border-bottom-left-radius:15px;
			border-bottom-right-radius:15px;
		}
		
		#header, #footer {
			width:900px;
		}
		#content {
			position:fixed;
			width:1000px;
		}
		
		#header, #footer{
			border:1px solid rgba(250,250,250,0.6);
			z-index:5;
		}
		
		#content {
			background-color:rgba(221,221,221,0.8);
			box-shadow: 0 0 15px 2px black;
			bottom:0px;
			top:0px;
			border-left:2px solid rgba(250,250,250,0.8);
			border-right:2px solid rgba(250,250,250,0.8);
			padding-top:80px;
			padding-left:30px;
		}

		.category {
			position:relative;
			width:160px;
		}		
		.p_category {
			position:relative;
			width:160px;
		}	
		#footer {
			height:50px;
			position:fixed;
			bottom:0px;
			background-color:rgba(221,221,221,0.6);
			box-shadow: 0 0 15px 1px black;
			border-top-left-radius:15px;
			border-top-right-radius:15px;
		}
		#edit_tab {
			position:fixed;
			top:400px;
			right: 0px;
			height:200px;
			width:21px;
			background-color:rgba(221,221,221,0.8);
			box-shadow: 0 0 5px 1px black;
			border-bottom-left-radius:15px;
			border-top-left-radius:15px;
		}
		#edit_tab.open {
			position:fixed;
			top:200px;
			right: 0px;
			height:200px;
			width:601px;
			background-color:rgba(221,221,221,0.8);
			box-shadow: 0 0 5px 1px black;
			border-bottom-left-radius:15px;
			border-top-left-radius:15px;
		}
		#admin_tab {
			position:fixed;
			top:150px;
			left: 0px;
			height:400px;
			width:21px;
			background-color:rgba(221,221,221,0.85);
			box-shadow: 0 0 5px 1px black;
			border-bottom-right-radius:15px;
			border-top-right-radius:15px;
			overflow:hidden;
		}
		#admin_tab.open {
			position:fixed;
			top:150px;
			left: 0px;
			height:400px;
			width:601px;
			background-color:rgba(221,221,221,0.85);
			box-shadow: 0 0 5px 1px black;
			border-bottom-right-radius:15px;
			border-top-right-radius:15px;
			overflow:hidden;
		}
		#switch_admin {
			position:absolute;
			width:20px;
			height:400px;
			background-color:rgba(200,200,200,1);
			right:0px;
			top:0px;
			border-bottom-right-radius:15px;
			border-top-right-radius:15px;
			padding-left:5px;
		}
		#switch {
			position:absolute;
			width:20px;
			height:200px;
			background-color:rgba(200,200,200,1);
			left:0px;
			border-bottom-left-radius:15px;
			border-top-left-radius:15px;
			padding-left:5px;
		}
		#login_area {
			//border:1px solid pink;
			width:900px;
			position:relative;
			left:20px;
			top:5px;
		}
		#search_area {
			//border:1px solid pink;
			width:900px;
			position:absolute;
			left:400px;
			top:15px;
		}
		input[type=text],input[type=password] {
			border-style:none;
			margin-top:0px; 
			margin-bottom:0px;
			width:160px;
			background-color:rgba(250,250,250,0.6);
		}
		textarea {
			border:0px;
			background-color:rgba(250,250,250,0.6);
			width:160px; 
			height:90px;
			resize:none;
		}
		textarea .p_desc{
			border:0px;
			background-color:rgba(250,250,250,0.6);
		}
		select {
			border-style:none;
			background-color:rgba(250,250,250,0.3);
		}
		option {
			
		}
		#email.textlabel {
			border:none;
			background-color:rgba(0,0,0,0);
		}
		button {
			background-color:rgba(220,220,220,0.3);
			text-shadow:1px 0px rgba(250,250,250,1);
			color:rgba(100,100,100,1); 
			font:normal normal normal 13px/normal Arial;
		}
		button:hover {
			background-color:rgba(220,220,220,0.6);
			color:black;
			font:normal normal normal 13px/normal Arial;
		}
		#preview_frame {
			position:absolute;
			left:65px;
			top:20px;
			height:110px; 
			width:110px;
			border-radius:10px;
			border:2px dashed rgba(250,250,250,0.9);
			color:rgba(100,100,100,1);
			text-shadow:2px 0px rgba(250,250,250,1);
			font-size:15px;
		}
		#preview {
			position:relative;
			left:5px;
			top:5px;
		}
		#product_info {
			position:absolute;
			top:9px;
			left:29px;
			width:370px;
		}
		td {
			border:0px solid gray;
		}
		#product_list_frame li {
			color:rgba(100,100,100,1);
			text-shadow:0px 0px rgba(250,250,250,1);
			border-bottom:2px solid rgba(230,230,230,0.8);
			padding-top:15px; 
			margin:0px;
			height:70px;
			text-shadow:2px 0px rgba(250,250,250,1);
			font:normal normal normal 15px/normal Arial;
		}

		#product_list_frame .product_item {
			position:relative;
			left:10px;
			width:850px;
			height:160px; 
		}
		#product_list_frame .product_item .p_logo {
			border:1px solid gray;
			width:110px; 
			height:110px;
		}

		#product_list_frame .product_item .p_table {
			position:absolute;
			top:0px;
			left:150px;
			font:normal normal normal 15px/normal Arial;
		}
		#product_info table tr td {
			color:rgba(100,100,100,1);
			text-shadow:2px 0px rgba(250,250,250,1);
			font:normal normal normal 13px/normal Arial;
		}
		.product_item .edit_product {
			position: absolute;
			width:80px;
			height:60px;
			left:770px;
			top:0px;
			color:gray;
			background-color:rgba(10,220,10,0.3);
		}
		.product_item .edit_product:hover {
			background-color:rgba(10,220,10,0.6);
			color:black;
		}
		.product_item .del_product {
			position: absolute;
			width:80px;
			height:100px;
			left:680px;
			top:0px;
			color:gray;
			background-color:rgba(220,10,10,0.3);
		}
		.product_item .del_product:hover {
			background-color:rgba(220,10,10,0.6);
		}
		a:link {text-decoration:none;}
		a:visited {text-decoration:none;}
		a:hover {text-decoration:underline;}
		a:active {text-decoration:none;}
		
	</style>
</head>

<body>
	
	<div id="header">
		<div id="login_area">
			<table>
				<tr>
					<td style="width:65px;font-size:10px;color:gray;">USEREMAIL</td>
					<td ><input type="text" value="" title="USER EMAIL" id="email" 
					style="margin-top:0px; margin-bottom:0px;"></td>
				</tr>
				<tr>
					<td style="width:65px;font-size:10px;color:gray;">PASSWORD</td>
					<td><input type="password" id="passwd"></td>
				</tr>
			</table>
			
			
			<button id="login" style="position:absolute; top:3px; left:245px;height:45px;">
				Log In
			</button>
		</div>
		<div id="search_area">
			<select id="category1" selected_id=1 class="category" title="Search in">
<!--
				<option category_id=0>revise category</option>
-->
				<option category_id=1>revise user</option>
			</select>
			<input type="text" style="width:200px;" id="keywd" title="Search for">
			<button id="search" title="Search for specific item.">Search Item</button>
		</div>
	</div>
	
	<div id="content">
		<ul id="product_list_frame" style="position:absolute; width:90%;height:600px;top:70px; 
		left:60px; list-style:none; padding:0px;margin:0px;margin-bottom:80px; overflow-y:auto; ">
		</ul>
		<table style="position:absolute; bottom:70px; width:100%;font:normal normal normal 13px/normal Arial;">
			<tr >
				<td style="text-align:center;color:rgba(100,100,100,1);	text-shadow:2px 0px rgba(250,250,250,1);">
					GO TO PAGE:
					<select id="page_num"  style="width:50px;" current_offst=0>
						<option offst=0>1</option>
					</select>
				</td>
			</tr>
		</table>
	</div>
	
	<div id="footer">
		<table style="position:absolute; bottom:10px; width:100%; height:30px;">
			<tr >
				<td style="text-align:center;color:rgba(100,100,100,1);	text-shadow:2px 0px rgba(250,250,250,1);">
					Copyright © 2013  <a href="mailto:kxing@srspharmacy.com" 
					style="color:rgba(100,100,100,1);text-shadow:2px 0px rgba(250,250,250,1);">
					KUAN
					</a>
				</td>
			</tr>
		</table>
	</div>

	<div id="edit_tab">
		<div id="switch"><br><br><br><br>◄</div>
		<div id="product_info">
			<div style="width:900px;background:rgba(221,221,221,0.6); border:0px solid purple;">
				<table style="width:900px; height:60px; border-bottom: 0px solid white;">
					<tr>
						<td style="width:80px;">user name:</td>
						<td style="width:200px;">
							<input type="text" value="" title="USER NAME" id="reg_name" 
							style="margin-top:0px; margin-bottom:0px;">
						</td>
						<td style="width:100px;">admin status</td>
						<td>
							<select id="reg_admn" class="admn" active=0 style="width:80px;border:0px solid gray;
							color:white;background:rgba(200,0,0,0.6);">
								<option active=0 style="color:white;background:rgba(200,0,0,0.6);">
								disabled</option>
								<option active=1 style="color:white;background:rgba(0,200,0,0.6);">
								enabled</option>
							</select>
						</td>
					</tr>
					<tr>
						<td style="width:80px;">user email:</td>
						<td style="width:200px;">
							<input type="text" value="" title="USER EMAIL" id="reg_email" 
							style="margin-top:0px; margin-bottom:0px;">
						</td>
						<td>active status</td>
						<td>
							<select id="reg_n_a" class="n_a" active=1 style="width:80px;border:0px solid gray;
							color:white;background:rgba(0,200,0,0.6);">
								<option active=1 style="color:white;background:rgba(0,200,0,0.6);">
								enabled</option>
								<option active=0 style="color:white;background:rgba(200,0,0,0.6);">
								disabled</option>
							</select>
						</td>
					</tr>
				</table>
			</div>
			<button id="add_user">Add User</button>
		</div>
	</div>
	<script>
		

		
		jQuery(function($){
			
			//global variable for sync ajax request
			var cur_category_list={};
			var cur_product_info={};
			
			// store current query for changing page.
			var current_query="";
			var num_per_page=2;

			// cur_r is used for building product list params
			var cur_r={};
			
/////////////////////////////////////////////////////////////////////////////////////////
			// most client side operation should involve this first. 
			function auth_user(suc_cb, err_cb){
			// originally I plan to send out a user_id to server to auth
			// later I found the cookie can store that info and auto sent with request.
			// the returned data will be in JSON format and there is a "authed" var can show if
			// this user has been authened. The return data will be automatically binded to first 
			// param of callback function.
				$.ajax({
					url:"/auth/admin/",
					type:"POST",
					datatype:'JSON',
					success: suc_cb,
					error: err_cb||function(err){alert(err.responseText);}
				});
			};

			// Global control for authentication status
			function not_authed(){
				$('#login').text('Log In');
				$('#email').removeAttr('readonly');
				$('#email').val('');
				$('#email').removeClass('textlabel');
				$('#passwd').val('');
				$('#passwd').show();
				$('#email').focus();
			};
			function is_authed(data){
				$('#login').text('Log out');
				$('#email').val(data.user_email);
				$('#email').attr('readonly', 'readonly');
				$('#email').addClass('textlabel');
				$('#passwd').hide();
			};
			//Some utils for form validation
			function isNumeric(num) {
			  return !isNaN(parseFloat(num)) && isFinite(num);
			};
			function isEmpty(txt){
				return (txt.trim().length==0);
			}

// Deep copy a JSON object
function clone(a) {
   return JSON.parse(JSON.stringify(a));
}

// fill cur_r with current page params.
function bld_qstr(){
	cur_r={};
	cur_r.task_id=$("#category1").attr("selected_id");
	var keywd;
	if($("#keywd").val().trim().length>0){
		keywd = $("#keywd").val().trim().split(' ');
		cur_r.keywd = keywd;
	}
	
	cur_r.result_num = num_per_page;
	cur_r.offst = 0;
	//cur_r.offst = $('#page_num').attr('current_offst');
	console.log(cur_r);
};
				
			// One thing to remember, when you want to do a html mangling,
			// you can use jQuery .text(), it can convert those.
			
			//Global Product Form validation
			function valid_form( p_form ){
				var tips='';
/* the form passed in looks like this:
				var product_form = {
					name:$("#product_name").val(),
					category:$("#product_category").attr("selected_id"),
					price:$("#product_price").val(),
					amount:$("#product_amnt").val(),
					description:$("#product_desc").val(),
					img_data:img_data
				};
*/
				if( isEmpty(p_form.name) ){
					tips+="You need fill name. ";
				}
				if( !isNumeric(p_form.price) ){
					tips+="You need a valid price number. ";
				}
				if( !isNumeric(p_form.amount) ){
					tips+="You need a valid amount number. ";
				}
				if( isEmpty(p_form.description) ){
					tips+="You need to describe your product."
				}
				if(tips.length==0){
					return {valid:true, tips:tips};
				}
				else {
					return {valid:false, tips:tips};
				}				
			};
			
/////////////////////////////////////////////////////////////////////////////////////////////////////////			

			
			// this function is for getting all category info from server
			// data return from server is all category id and name
			
	//!!!!!!! THIS AJAX IS SYNC RATHER THAN ASYNC TO MAKE SURE WE GET THE CAT_INFO FIRST!!!!!!!!!//
			function get_category(r, suc_cb, err_cb){
				$.ajax({
					url:"/s_category/admin/",
					type:"POST",
					datatype:'JSON',
					success: suc_cb,
					error:err_cb||function(){alert('Failed to get category info.');},
					async:false
				});
			};

function render_category_item(data){
	
};
	
			function fill_category(data){
				
			};
						
			function get_user(r, suc_cb, err_cb){
				$.ajax({
					url:"/s_user/admin/",
					type:"POST",
					datatype:'JSON',
					data:r,
					success: suc_cb,
					error: err_cb||function(err){alert(err.responseText);},
					async:false
				});
			};

function build_active(params){
	if(params.n_a==true) {
		return '\
						<select class="n_a" active=0 style="width:80px;border:0px solid gray;\
						color:white;background:rgba(200,0,0,0.6);">\
							<option active=0 style="color:white;background:rgba(200,0,0,0.6);">\
							disabled</option>\
							<option active=1 style="color:white;background:rgba(0,200,0,0.6);">\
							enabled</option>\
						</select>\
		';
	}
	else {
		if(params.email!=$('#email').val()){
			return '\
							<select class="n_a" active=1 style="width:80px;border:0px solid gray;\
							color:white;background:rgba(0,200,0,0.6);">\
								<option active=1 style="color:white;background:rgba(0,200,0,0.6);">\
								enabled</option>\
								<option active=0 style="color:white;background:rgba(200,0,0,0.6);">\
								disabled</option>\
							</select>\
			';				
		}
		else {
			return '\
				<select class="n_a" active=1 style="width:80px;border:0px solid gray;\
				color:white;background:rgba(0,200,0,0.6);">\
					<option active=1 style="color:white;background:rgba(0,200,0,0.6);">\
					enabled</option>\
				</select>\
			';
		}

	}
}

function build_admin(params){
	if(params.admn==false) {
		return '\
						<select class="admn" active=0 style="width:80px;border:0px solid gray;\
						color:white;background:rgba(200,0,0,0.6);">\
							<option active=0 style="color:white;background:rgba(200,0,0,0.6);">\
							disabled</option>\
							<option active=1 style="color:white;background:rgba(0,200,0,0.6);">\
							enabled</option>\
						</select>\
		';
	}
	else {
		if(params.email!=$('#email').val()){
			return '\
							<select class="admn" active=1 style="width:80px;border:0px solid gray;\
							color:white;background:rgba(0,200,0,0.6);">\
								<option active=1 style="color:white;background:rgba(0,200,0,0.6);">\
								enabled</option>\
								<option active=0 style="color:white;background:rgba(200,0,0,0.6);">\
								disabled</option>\
							</select>\
			';				
		}
		else {
			return '\
				<select class="admn" active=1 style="width:80px;border:0px solid gray;\
				color:white;background:rgba(0,200,0,0.6);">\
					<option active=1 style="color:white;background:rgba(0,200,0,0.6);">\
					enabled</option>\
				</select>\
			';
		}

	}
}

function render_user_item(params){
	// the params looks like
	/*
						{
							total_num:r_num,
							page_list:result.rows
						}
	*/


	
	var template = '\
		<li>\
		<div class="product_item" u_id='+params.id+'>\
			<div style="width:900px;background:rgba(221,221,221,0.6); border:0px solid purple;">\
				<table style="width:900px; height:60px; border-bottom: 0px solid white;">\
					<tr>\
						<td style="width:80px;">user name:</td><td style="width:200px;">'+params.name+'</td>\
						<td style="width:100px;">admin status</td>\
						<td>'+build_admin(params)+'\
						</td>\
					</tr>\
					<tr>\
						<td style="width:80px;">user email:</td><td style="width:200px;">'+params.email+'</td>\
						<td>active status</td>\
						<td>'+build_active(params)+'\
						</td>\
					</tr>\
				</table>\
			</div>\
			<button class="edit_product">Update User</button>\
		</div>\
		</li>\
	';
	return template;
};
		
			function fill_user(data){
				// return user list(data) looks like:
				/*	{
						total_num:r_num,
						page_list:result.rows
					}
				*/
				cur_product_info = clone(data);
				var p_list_str="No user found.";
				if(data.page_list.length>0) {
					p_list_str='';
					$.each(data.page_list, function(index, val){
						p_list_str+=render_user_item(val);
					});
				}
				$("#product_list_frame").html(p_list_str);
				
				$(".n_a,.admn").change(function(){
					$(this).attr("active",$(this).find('option:selected').attr('active'));
					if($(this).attr('active')==0){
						$(this).css('background','rgba(200,0,0,0.6)');
					}
					else {
						$(this).css('background','rgba(0,200,0,0.6)');
					}
				});
				
				// this is the product update button click event handler
				$(".edit_product").click(function(){
					
					var updt_info = {
						user_id:$(this).parent().attr('u_id'),
						admn:$(this).parent().find(".admn").attr('active')==1?true:false,
						n_a:$(this).parent().find(".n_a").attr('active')==1?false:true
					};
					
					function edit_user(updt_info){
						// the updt_info looks like
						// Right now, you can not change picture :(
						/*
								{
									admn:true,
									n_a:false
								};
						*/
						$.ajax({
							url:"/u_user/",
							type:"POST",
							data:updt_info,
							datatype:"JSON",
							success:function(data){
								if(data.suc){
									alert('User updated.');
								}
								else {
									alert('You can not edit this user.');
								}					
							},
							error:function(err){alert(err.responseText);}
						});
					};

					// this just a wraper function 
					function u_product(data){
						if(data.authed){
							edit_user(updt_info, refresh_lst);
						}
						else {
							alert("User not authenticated.");
							not_authed();
						}
					};
					
					auth_user(u_product);
				});
				
			};
		
			// this part is for checking if a user logged in, and send back to client side
			// to change client login area style(such as lock the login textbox and set logout button)
			function set_user_login_info(){
				// when the page first loaded, we need to check if there has been already
				// user logged-in info, if so, we need lock user login text box and show 
				// logout button. 
				function suc_cb(data){
					if(data.authed){
						is_authed(data);
					}
					else {
						not_authed();
					}
				};
				auth_user(suc_cb);
			};

			function build_page_list(n){
				// n is total number of results return
				var total_pnum = 1;
				if(n>0){
					total_pnum = Math.floor(n/num_per_page)+((n%num_per_page==0)?0:1);
				}
				console.log(total_pnum);
				var page_num_list='';
				for (var i =0; i<total_pnum; i++){
					page_num_list += "<option offst="+i+">"+(i+1)+"</option>";
				}
				$('#page_num').html(page_num_list);
				$('#page_num').attr('current_offst',0);
			};

			function refresh_lst(get_func, fill_func){
				// In get_func, we just request some url with cur_r params,
				// after the data return, we use it as input to fill_func
				// in fill_func, we git that return data to cur_product_info
				get_func(cur_r, fill_func);
				build_page_list(cur_product_info.total_num);
			};
			
			
/////////////////////////////////////////////////////////////////////////////////////////////////////////


			function init_load(){
			// this part is for adjusting the layout
				var ww = $(window).width();
				var hw = $("#header").width();
				if((ww-hw)/2 > 0){
					$("#header,#footer").css("left",(ww-hw)/2);
				}
				else {
					$("#header,#footer").css("left",0);
				}
				
				var cw = $("#content").width();
				if((ww-cw)/2 > 15){
					$("#content").css("left",(ww-cw)/2-15);
				}
				else {
					$("#content").css("left",0);
				}
				
				var wh = $(window).height();
				var hh = $("#header").height();
				
				$("#edit_tab").css("top",0.5*(wh-$("#edit_tab").height())+"px");
				$("#admin_tab").css("top",0.5*(wh-$("#admin_tab").height())+"px");
				var plfh = wh-2*hh;
				$('#product_list_frame').height(plfh-50);
				
				
				//get_category(fill_category);	
				set_user_login_info();




				//bld_qstr();
				//refresh_lst();
				// this is the end of init_load();	
			};
			init_load();

			$('#login').click(function(){
				function suc_cb(data){
					console.log(data);
					if(data.login){
						is_authed(data);
					}
					else {
						not_authed();
					}
				};
			// this function is for login button click
			// it could be login or logout
				function user_login(email, passwd, success_cb, error_cb){
					$.ajax({
						url:"/login/admin/",
						type:"POST",
						datatype:'JSON',
						data:{
							'email':email,
							'passwd':passwd
						},
						success: success_cb,
						error: error_cb||function(err){alert(err.responseText);}
					});
				};
				user_login( $('#email').val().trim(), $('#passwd').val().trim(), suc_cb);
			});	

			$('.category').change(function(){
				$(this).attr('selected_id',$(this).find("option:selected").attr("category_id"));
			});
			
			$("#search").click(function(){
				bld_qstr();
				console.log("after build:",cur_r)
				switch ( $("#category1").attr("selected_id") ) 
				{
					case '0': 
						refresh_lst(get_category, fill_category);
						break;
					case '1':
						refresh_lst(get_user, fill_user);
						break;
					default:
						alert("System error.");
				}
			});
		
			$(window).resize(function(){
				var ww = $(window).width();
				var hw = $("#header").width();
				if((ww-hw)/2 > 0){
					$("#header,#footer").css("left",(ww-hw)/2);
				}
				else {
					$("#header,#footer").css("left",0);
				}
				var cw = $("#content").width();
				if((ww-cw)/2 > 15){
					$("#content").css("left",(ww-cw)/2-15);
				}
				else {
					$("#content").css("left",0);
				}
					
				var wh = $(window).height();
				var hh = $("#header").height();

				$("#edit_tab").css("top",0.5*(wh-$("#edit_tab").height())+"px");
				$("#admin_tab").css("top",0.5*(wh-$("#admin_tab").height())+"px");
				var plfh = wh-2*hh;
				$('#product_list_frame').height(plfh-50);
				
				
			});

				
				function blank_form(){
					// After successful posting, we need to load a new empty form
					$("#product_name").val("");
					$("#product_price").val("");
					$("#product_amnt").val("");
					$("#product_desc").val("");
				};
				
				
			$("#page_num").change(function(){
				$(this).attr('current_offst',$(this).find("option:selected").attr("offst"));
				cur_r.offst = $(this).attr('current_offst')*num_per_page;
				console.log("after change page#:",cur_r);
				
				switch ( cur_r.task_id ) 
				{
					case '0': 
						get_category(cur_r, fill_category);
						break;
					case '1':
						get_user(cur_r, fill_user);
						break;
					default:
						alert("System error.");
				}
			});

			$("#switch").click(function(){
				$('#edit_tab').toggleClass("open",500);
				if($("#switch").html()=="<br><br><br><br>►") {
					$("#switch").html("<br><br><br><br>◄");
				}
				else {
					$("#switch").html("<br><br><br><br>►");
				}
				});

			$(".n_a,.admn").change(function(){
				$(this).attr("active",$(this).find('option:selected').attr('active'));
				if($(this).attr('active')==0){
					$(this).css('background','rgba(200,0,0,0.6)');
				}
				else {
					$(this).css('background','rgba(0,200,0,0.6)');
				}
			});
			
			$("#add_user").click(function(){

				var updt_info={
					name:$("#reg_name").val().trim(),
					email:$("#reg_email").val().trim(),
					admn:$(this).parent().find(".admn").attr('active')==1?true:false,
					n_a:$(this).parent().find(".n_a").attr('active')==1?false:true
				};
				
				function add_user(updt_info){
					// the updt_info looks like
					// Right now, you can not change picture :(
					/*
							{
								admn:true,
								n_a:false
							};
					*/
					$.ajax({
						url:"/a_user/",
						type:"POST",
						data:updt_info,
						datatype:"JSON",
						success:function(data){
							if(data.suc){
								alert('User added.');
								$("#reg_name").val("");
								$("#reg_email").val("");
							}
							else {
								alert('You can not add user.');
							}					
						},
						error:function(err){alert(err.responseText);}
					});
				};
			
				function a_user(data){
					if(data.authed) {
						add_user(updt_info);
					}
					else {
						alert("User not authenticated.");
						not_authed();
					}
				};
							
				if( isEmpty(updt_info.name) || isEmpty(updt_info.email)){
					alert("Make sure you fill name and email.");
				}
				else {
					auth_user(a_user);
				}
				
			});
// I register UPDATE button click event in fill_product() function
// because we need to register this call back to newly generated elements, otherwise
// they will never work.






			
			// this is the end of jQuery(function($))
			});
	</script>
	
</body>

</html>
